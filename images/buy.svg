<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="527px" preserveAspectRatio="none" style="width:365px;height:527px;background:#FFFFFF;" version="1.1" viewBox="0 0 365 527" width="365px" zoomAndPan="magnify"><defs><filter height="300%" id="f1jwn9su7auafq" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="79" x="141" y="28.708">Buy USN</text><rect fill="#FFFFFF" filter="url(#f1jwn9su7auafq)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="289" y="232.0469"/><rect fill="#FFFFFF" filter="url(#f1jwn9su7auafq)" height="159.6641" style="stroke:#000000;stroke-width:2.0;" width="225" x="126" y="193.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="30" x2="30" y1="75.25" y2="483.8438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="158" x2="158" y1="75.25" y2="483.8438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="294" x2="294" y1="75.25" y2="483.8438"/><rect fill="#FEFECE" filter="url(#f1jwn9su7auafq)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="46" x="5" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="12" y="59.9482">Alice</text><rect fill="#FEFECE" filter="url(#f1jwn9su7auafq)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="46" x="5" y="482.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="12" y="502.8389">Alice</text><rect fill="#FEFECE" filter="url(#f1jwn9su7auafq)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="40" x="136" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26" x="143" y="59.9482">usn</text><rect fill="#FEFECE" filter="url(#f1jwn9su7auafq)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="40" x="136" y="482.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26" x="143" y="502.8389">usn</text><rect fill="#FEFECE" filter="url(#f1jwn9su7auafq)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="90" x="247" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="254" y="59.9482">priceoracle</text><rect fill="#FEFECE" filter="url(#f1jwn9su7auafq)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="90" x="247" y="482.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="254" y="502.8389">priceoracle</text><rect fill="#FFFFFF" filter="url(#f1jwn9su7auafq)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="289" y="232.0469"/><polygon fill="#A80036" points="146,132.6484,156,136.6484,146,140.6484,150,136.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="30" x2="152" y1="136.6484" y2="136.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="37" y="101.3169">send NEAR</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="37" y="116.4497">+ expected rate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="68" x="37" y="131.5825">+ slippage</text><line style="stroke:#A80036;stroke-width:1.0;" x1="158" x2="200" y1="165.7813" y2="165.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="200" x2="200" y1="165.7813" y2="178.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="159" x2="200" y1="178.7813" y2="178.7813"/><polygon fill="#A80036" points="169,174.7813,159,178.7813,169,182.7813,165,178.7813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="165" y="160.7153">check price cache</text><path d="M126,193.7813 L190,193.7813 L190,200.7813 L180,210.7813 L126,210.7813 L126,193.7813 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="159.6641" style="stroke:#000000;stroke-width:2.0;" width="225" x="126" y="193.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="141" y="206.8481">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="141" x="205" y="205.9917">[Cache is invalidated]</text><polygon fill="#A80036" points="277,228.0469,287,232.0469,277,236.0469,281,232.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="158" x2="283" y1="232.0469" y2="232.0469"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="165" y="226.981">get_price_data</text><polygon fill="#A80036" points="169,257.1797,159,261.1797,169,265.1797,165,261.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="163" x2="293" y1="261.1797" y2="261.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="175" y="256.1138">NEAR/USDT rate</text><line style="stroke:#A80036;stroke-width:1.0;" x1="158" x2="200" y1="290.3125" y2="290.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="200" x2="200" y1="290.3125" y2="303.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="159" x2="200" y1="303.3125" y2="303.3125"/><polygon fill="#A80036" points="169,299.3125,159,303.3125,169,307.3125,165,303.3125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="165" y="285.2466">verify timestamp</text><line style="stroke:#A80036;stroke-width:1.0;" x1="158" x2="200" y1="332.4453" y2="332.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="200" x2="200" y1="332.4453" y2="345.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="159" x2="200" y1="345.4453" y2="345.4453"/><polygon fill="#A80036" points="169,341.4453,159,345.4453,169,349.4453,165,345.4453" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="165" y="327.3794">update cache</text><line style="stroke:#A80036;stroke-width:1.0;" x1="158" x2="200" y1="381.5781" y2="381.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="200" x2="200" y1="381.5781" y2="394.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="159" x2="200" y1="394.5781" y2="394.5781"/><polygon fill="#A80036" points="169,390.5781,159,394.5781,169,398.5781,165,394.5781" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="165" y="376.5122">assert slippage</text><line style="stroke:#A80036;stroke-width:1.0;" x1="158" x2="200" y1="423.7109" y2="423.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="200" x2="200" y1="423.7109" y2="436.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="159" x2="200" y1="436.7109" y2="436.7109"/><polygon fill="#A80036" points="169,432.7109,159,436.7109,169,440.7109,165,436.7109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="165" y="418.645">mint USN</text><polygon fill="#A80036" points="41,461.8438,31,465.8438,41,469.8438,37,465.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="35" x2="157" y1="465.8438" y2="465.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="47" y="460.7778">USN amount</text><!--MD5=[3cc82c76eb17cbe4be7ad37c111dff50]
@startuml

title Buy USN

Alice -> usn: send NEAR\n+ expected rate\n+ slippage
usn -> usn: check price cache

alt Cache is invalidated
usn -> priceoracle: ""get_price_data""
activate priceoracle
usn <- priceoracle: NEAR/USDT rate
deactivate priceoracle
usn -> usn: verify timestamp
usn -> usn: update cache
end

usn -> usn: assert slippage
usn -> usn: mint USN

Alice <- - usn: USN amount
@enduml

PlantUML version 1.2022.0(Tue Jan 11 18:16:42 EET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>